define("taoDevTools/controller/routes",[],function(){return{ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}}}}),define("taoDevTools/controller/settings/extensionManager",["jquery","i18n","context","helpers"],function(e,n,t,a){function s(n){var t=[];return e("#"+n+" .dependencies li:not(.installed)").each(function(){var n=e(this).attr("rel"),a=s(n);a.push(n),t=t.concat(a)}),t}function o(n){for(var t=[],a=0;a<n.length;a++)e.inArray(n[a],t)<0&&t.push(n[a]);return t}function i(n){e("#installProgress .console").append("<p>"+n+"</p>"),e("#installProgress .console").prop({scrollTop:e("#installProgress .console").prop("scrollHeight")})}function l(){var s=u[g];e("#installProgress p.status").text(n("Installing extension %s...").replace("%s",s)),i(n("Installing extension %s...").replace("%s",s)),e.ajax({type:"POST",url:t.root_url+"tao/ExtensionsManager/install",data:"id="+s,dataType:"json",success:function(t){a.loaded(),t.success?(i(n("> Extension %s succesfully installed.").replace("%s",s)),e("#installProgress .bar").animate({width:"+="+p+"%"},1e3,function(){g++,r()})):(x=1,i("Installation of "+s+" failed")),a.createInfoMessage(t.message)}}),x&&i(n("A fatal error occured during the installation process."))}function r(){g>=u.length?(u=[],e("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),i(n("Generating cache...")),e.ajax({type:"GET",url:e(e("#main-menu a")[0]).prop("href"),success:function(){a.loaded(),e("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),e("#installProgress p.status").text(n("Installation done.")),i(n("> Installation done.")),window.location.reload()}})):l()}function c(){e("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),e("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),e("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd")}var d=[],u=[],g=-1,p=0,x=0;return{start:function(){c(),e("#installProgress").hide(),e("#addButton").click(function(){var t=a._url("create","ExtensionsManager","taoDevTools")+"?"+e.param({uri:e("#openuri").val()});return a.openTab(n("Create new extension"),t),!1}),e("#extensions-manager-container .ext-id").each(function(){var n=e(this).text();d.push(n),e(".ext-id.ext-"+n).addClass("installed")}),e("#available-extensions-container tr input").click(function(e){e.stopPropagation()}),e("#available-extensions-container tr input:checkbox").click(function(){var n=e("#installButton");e(this).parent().parent().parent().find("input:checkbox:checked").length>0?n.attr("disabled",!1):n.attr("disabled",!0)}),e("#installButton").click(function(t){return u=[],e("#available-extensions-container input:checked").each(function(){var n=e(this).prop("name").split("_")[1],t=s(n);t.length&&(u=u.concat(t)),u.push(n)}),u=o(u),0==u.length?(alert(n("Nothing to install !")),!1):(p=100/u.length,e("#installProgress p.status").text(n("%s extension(s) to install.").replace("%s",u.length)),e("#installProgress .bar").width(0),e("#installProgress .console").empty(),i(n("Do you wish to install the following extension(s):\n%s?").replace("%s",u.join(", "))),e("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:n("No"),click:function(){e(this).dialog("close")}},{text:n("Yes"),click:function(){i(n("Preparing installation...")),e(".ui-dialog-buttonpane").remove(),x=0,g=0,l()}}]}),void t.preventDefault())}),e(".disableButton").click(function(n){var s=e(n.target).data("extid");e.ajax({type:"POST",url:t.root_url+"taoDevTools/ExtensionsManager/disable",data:"id="+s,dataType:"json",success:function(e){a.loaded(),a.createInfoMessage(e.message),e.success&&window.location.reload()}})}),e(".enableButton").click(function(n){var s=e(n.target).data("extid");e.ajax({type:"POST",url:t.root_url+"taoDevTools/ExtensionsManager/enable",data:"id="+s,dataType:"json",success:function(e){a.loaded(),a.createInfoMessage(e.message),e.success&&window.location.reload()}})}),e(".uninstallButton").click(function(n){var s=e(n.target).data("extid");e.ajax({type:"POST",url:t.root_url+"taoDevTools/ExtensionsManager/uninstall",data:"id="+s,dataType:"json",success:function(e){a.loaded(),a.createInfoMessage(e.message),e.success&&window.location.reload()}})})}}});